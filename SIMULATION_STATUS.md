# Phase 0 シミュレーション 進捗状況レポート

**作成日：** 2026-02-15
**実行パラメータ（初回）：** κ=1.0, θ=0.3, β=1.0, Bloom間隔=7日, Grace Period=30日

---

## 1. 実装状況

### ✅ 実装済み（Stage 1 & 2 完了）

| モジュール | ファイル | 内容 |
|---|---|---|
| ネットワーク生成 | `simulation/network_generator.py` | Watts-Strogatz小世界ネットワーク、SimulationState管理 |
| 取引シミュレーション | `simulation/transaction_engine.py` | Poisson(λ=2) 日次取引、攻撃者戦略3種 |
| スコアリング | `simulation/scoring.py` | 3軸 T(v)/E(v)/D(v)、softmin S(v)、F(v)フラグ、g(S)減価加速 |
| Mana配分 | `simulation/mana_distributor.py` | 75%均等配分 + 25% VRF Bloom抽選、DecayEngine |
| コミュニティ検出 | `simulation/community_detector.py` | Louvain月次クラスタリング、α(c)正規化係数 |
| 評価指標 | `simulation/metrics.py` | Sybil ROI, TPR/FPR, Gini, VRF公平性、安定化期間 |
| 実行基盤 | `simulation/runner.py` | 180日ループ、全シナリオ対応、出力管理 |
| パラメータ定義 | `simulation/config.py` | 全パラメータ範囲、T001〜T010定義 |
| Notebook（Stage 1） | `notebooks/01_basic_simulation.ipynb` | MVP検証、スコア分布・推移グラフ |
| Notebook（Stage 2） | `notebooks/02_scenario_testing.ipynb` | T001〜T010実行、全指標の可視化 |

### ❌ 未実装（Stage 3 以降）

| 項目 | ファイル予定 | 内容 |
|---|---|---|
| DoEパラメータ最適化 | `notebooks/03_parameter_optimization.ipynb` | L16直交表で κ×θ×β×Bloom間隔 を16通りで探索 |
| パラメータ感度分析 | 同上 | 各パラメータ±10%変化時の影響度を定量化 |
| T004実行（N=100K） | `runner.run_all_test_cases()` | 大規模ネットワーク検証（要時間・メモリ） |
| T010実行（距離軸比較） | 別途実装 | k=0〜100で3層 vs 4層 Sybil ROI比較 |
| 距離軸D(v)の本実装 | `simulation/scoring.py` | 現在は定数0.5のプレースホルダー。地理的一貫性スコアを実装 |
| ZK-SNARK証明コスト確認 | 別途 | 実装コストの実用性検証 |
| 最終パラメータ決定レポート | `results/final_report.md` | 全検証結果の集約と推奨値の提案 |

---

## 2. テストケース実行状況

**実行条件：** κ=1.0, θ=0.3, β=1.0, Bloom=7日, Grace=30日, 180日間シミュレーション

| ID | シナリオ | N | k | Sybil ROI | 目標 | 判定 | TPR | 目標 | 判定 | FPR | 目標 | 判定 | Gini | 判定 |
|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|
| T001 | A: 単純Sybil（基準） | 1K | 1 | 0.250 | <1.000 | ✅ | 0% | >95% | ❌ | 12.01% | <1% | ❌ | 0.685 | ❌ |
| T002 | A: 単純Sybil | 1K | 10 | 0.645 | <0.100 | ❌ | 10% | >95% | ❌ | 7.78% | <1% | ❌ | 0.702 | ❌ |
| T003 | A: 単純Sybil | 10K | 50 | 0.556 | <0.020 | ❌ | 14% | >95% | ❌ | 9.28% | <1% | ❌ | 0.704 | ❌ |
| T004 | A: 単純Sybil | 100K | 100 | — | <0.007 | ⏭️ | — | — | ⏭️ | — | — | ⏭️ | — | ⏭️ |
| T005 | B: デバイス制約 | 10K | 10 | 2.052 | <0.100 | ❌ | 10% | >95% | ❌ | 9.34% | <1% | ❌ | 0.707 | ❌ |
| T006 | C: 高頻度ループ | 10K | 5 | 69.745 | <0.200 | ❌ | 0% | >95% | ❌ | 0.01% | <1% | ✅ | 0.520 | ❌ |
| T007 | D: 農村FP | 10K | 0 | — | — | ✅ | — | — | ✅ | **0.17%** | <1% | ✅ | 0.601 | ❌ |
| T008 | E: 新規参加 | 10K | 0 | — | — | ✅ | — | — | ✅ | **0.01%** | <1% | ✅ | 0.507 | ❌ |
| T009 | F: Grace Period | 10K | 0 | — | — | ✅ | — | — | ✅ | **0.00%** | <1% | ✅ | 0.509 | ❌ |
| T010 | G: 距離軸比較 | 10K | 可変 | — | — | ⏭️ | — | — | ⏭️ | — | — | ⏭️ | — | ⏭️ |

**凡例：** ✅ 合格 ／ ❌ 不合格（要最適化） ／ ⏭️ 未実行

---

## 3. 評価指標ごとの集計

### 3.1 Sybil ROI（攻撃採算性）

| シナリオ | ROI | 目標 | 状況 |
|---|---|---|---|
| T001（k=1） | 0.250 | < 1.000 | ✅ 合格 |
| T002（k=10） | 0.645 | < 0.100 | ❌ 未達 |
| T003（k=50） | 0.556 | < 0.020 | ❌ 未達 |
| T005 デバイス制約 | 2.052 | < 0.100 | ❌ デバイス制約で逆に攻撃者が得している（要調査） |
| T006 ループ攻撃 | 69.745 | < 0.200 | ❌ 深刻：ループ攻撃者が大幅利得 |

**主要課題：** ループ攻撃（Scenario C）が大幅に利益を得ている。T(v)の高スコアにより正直者より有利になっている。

### 3.2 False Positive Rate（正直者の誤検出）

| シナリオ | FPR | 目標 | 状況 |
|---|---|---|---|
| T001〜T003（Sybil系） | 7.78〜12.01% | < 1% | ❌ θ=0.3 が低すぎ、正直者を誤検出 |
| T006 ループ攻撃 | 0.01% | < 1% | ✅ |
| T007 農村コミュニティ | 0.17% | < 1% | ✅ |
| T008 新規参加 | 0.01% | < 1% | ✅ |
| T009 Grace Period | 0.00% | < 1% | ✅ |

**主要課題：** Sybilシナリオ（A/B）で FPR が 8〜12%。θを0.3から0.5〜0.6に上げることで改善できる見込み。ただし TPR とのトレードオフあり。

### 3.3 True Positive Rate（攻撃者の検出率）

| シナリオ | TPR | 目標 | 状況 |
|---|---|---|---|
| T001（k=1） | 0% | > 95% | ❌ |
| T002（k=10） | 10% | > 95% | ❌ |
| T003（k=50） | 14% | > 95% | ❌ |
| T006 ループ攻撃 | 0% | > 95% | ❌ |

**主要課題：** Scenario A（正直者と同じ行動）では行動ベース検出が原理的に困難。デバイス紐づけ（第4軸）の実装が必須。Scenario C のループ攻撃は T(v) が高く偽装成功している。

### 3.4 Gini係数（分配公平性）

| 全テスト | Gini範囲 | 目標 | 状況 |
|---|---|---|---|
| T001〜T009 全体 | 0.507〜0.707 | 0.2〜0.3 | ❌ 全ケースで目標超 |

**主要課題：** Bloom イベントの集中配分と初期残高の差が拡大している。減価率(0.5%/日)とMana配分量のバランス調整が必要。

### 3.5 その他指標（良好な結果）

| 指標 | 結果 | 目標 | 状況 |
|---|---|---|---|
| VRF公平性 | 0.921〜0.987 | > 0.999 | △ 概ね良好（Bloomイベント25回では統計的限界あり） |
| コミュニティ安定性 | 0.944〜0.988 | > 0.95 | ✅ 大半で合格 |
| 安定化期間（新規） | 0日（中央値） | < 30日 | ✅ 初日から θ 到達 |

---

## 4. 原因分析と改善方針

### 問題1：FPR 高すぎ（Scenario A/B で 8〜12%）

**原因：** θ=0.3 に対して正直者のS(v)平均が 0.33 前後 → 分布の裾が閾値を下回る
**改善：** θ を 0.45〜0.55 に上げる（Stage 3 DoE で探索）

### 問題2：TPR が低すぎ（Scenario A で 0〜14%）

**原因：** Scenario A で攻撃者が正直者と同じ行動 → スコア差が生まれない
**改善：** デバイス紐づけ（D軸の本実装）が必須。構造的に差をつける設計が前提

### 問題3：T006 ループ攻撃の ROI が 69.7（深刻）

**原因：** ループ攻撃者の T(v) = 1.0（毎日活発）& E(v) ≈ 1.0（多数ループでエントロピー高）→ スコア高く Mana を大量取得、かつ F(v)=0 で減価も通常
**改善：** E(v) の計算を「取引相手の多様性」で補正する。同一相手との反復取引を低エントロピーとして検出

### 問題4：Gini が全体的に高い（0.5〜0.7）

**原因：** Bloom イベント1回の配分が大きく一部に集中。初期残高100の差が減価+Mana配分で拡大
**改善：** Bloom配分量を下げる（20〜25%）、または複数受賞者制への変更を検討

---

## 5. 未確認・未実施項目（Phase 0 チェックリスト対応）

仕様書 `phase0_specification.html` セクション7.3 より：

| チェック項目 | 状態 | 備考 |
|---|---|---|
| ☐ Sybil ROI(100) < 1/150 を達成 | ❌ 未達 | T004未実行。κ/θ最適化後に再検証 |
| ☐ False Positive 率 < 1% を達成 | △ 部分達成 | T007-T009は達成。Sybilシナリオは未達 |
| ☐ κ, θ の最適値を決定 | ❌ 未実施 | Stage 3 DoE で実施 |
| ☐ Bloom イベント間隔と配分量を決定 | ❌ 未実施 | Stage 3 DoE で実施 |
| ☐ 分析周期（月1回 vs 他）を決定 | ❌ 未実施 | Stage 3 DoE で実施 |
| ☐ Grace Period 期間を決定（30日 vs 他） | ❌ 未実施 | Stage 3 DoE で実施 |
| ☐ コミュニティ検出アルゴリズムを選定 | △ Louvain採用 | 他アルゴリズムとの比較は未実施 |
| ☐ ZK-SNARK 証明コストが実用的か確認 | ❌ 未実施 | シミュレーション外の検証 |
| ☐ 距離軸の要否を結論付ける | ❌ 未実施 | T010（Scenario G）が未実行 |
| ☐ 全テストケースでサクセス条件を満たすレポート作成 | ❌ 未完 | Stage 3 完了後 |

---

## 6. 次のアクション（Stage 3）

### 優先度 高
1. **DoEパラメータ最適化** `notebooks/03_parameter_optimization.ipynb`
   - L16直交表：κ×θ×β×Bloom間隔 で16実験
   - 目標関数：`Sybil_ROI × (1 + FPR×100) / TPR` を最小化

2. **E(v) エントロピー計算の改善** `simulation/scoring.py`
   - 「取引相手の多様性」を取り込む（同一相手への反復 = 低エントロピー）
   - Scenario C（ループ攻撃）の検出率向上

### 優先度 中
3. **T004 実行（N=100K）** — 大規模スケールでの検証
4. **T010 実行（Scenario G）** — 距離軸有無の Sybil ROI 比較
5. **D(v) 距離軸の本実装** — 現在は定数0.5。ネットワーク距離スコアを計算

### 優先度 低
6. **Gini 改善** — Bloom配分ロジックの見直し（複数受賞 or 配分量削減）
7. **コミュニティ安定性** — Louvain vs Leiden 比較
8. **ZK-SNARK コスト確認** — 外部ツールで別途検証

---

## 7. ファイル構成（現在）

```
Meguri_pre3/
├── simulation/               # ✅ コアエンジン（8モジュール）
│   ├── config.py             # パラメータ定義・T001〜T010
│   ├── network_generator.py  # Watts-Strogatz生成
│   ├── transaction_engine.py # Poisson取引・攻撃者戦略
│   ├── scoring.py            # 3軸スコア・softmin
│   ├── mana_distributor.py   # 75/25配分・VRF Bloom
│   ├── community_detector.py # Louvain・α(c)正規化
│   ├── metrics.py            # 全評価指標計算
│   └── runner.py             # シミュレーション実行基盤
├── notebooks/
│   ├── 01_basic_simulation.ipynb     # ✅ Stage 1 MVP検証
│   ├── 02_scenario_testing.ipynb     # ✅ T001〜T010実行
│   └── 03_parameter_optimization.ipynb  # ❌ 未作成（Stage 3）
├── results/
│   └── summary/              # ✅ T001〜T009の結果JSON
├── requirements.txt          # ✅ 依存ライブラリ
└── phase0_specification.html # 仕様書（参照）
```
